## 消息队列和事件循环

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/79354b4c1dde4e9da34a7ed99bb5a4b0~tplv-k3u1fbpfcp-watermark.image?)

- 如何处理高优先级的任务：通常我们把消息队列中的任务称为宏任务，每个宏任务中都包含了一个微任务队列，在执行宏任务的过程中，如果 DOM 有变化，那么就会将该变化添加到微任务列表中，这样就不会影响到宏任务的继续执行，因此也就解决了执行效率的问题
- 解决单个任务执行时长过久的问题：，JavaScript 可以通过回调功能来规避这种问题，也就是让要执行的 JavaScript 任务滞后执行。

## setTimeout是如何实现的

浏览器的页面是通过消息队列和事件循环系统来驱动的。settimeout的函数会被加入到延迟消息队列中，等到执行完Task任务之后就会执行延迟队列中的任务。然后分析几种场景下面的setimeout的执行方式。

- 如果执行一个很耗时的任务，会影响延迟消息队列中任务的执行
- 存在嵌套带调用时候，系统会设置最短时间间隔为4ms（超过5层）
- 未激活的页面，setTimeout最小时间间隔为1000ms
- 延时执行时间的最大值2147483647，溢出会导致定时器立即执行
- setTimeout设置回调函数this会是回调时候对应的this对象，可以使用箭头函数解决